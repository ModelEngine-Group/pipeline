-- 修改内置模型应用sql的用户信息为system
UPDATE "public"."app_builder_form"
SET
    "create_by" = CASE WHEN "create_by" = 'Jade' THEN 'system' ELSE "create_by" END,
    "update_by" = CASE WHEN "update_by" = 'Jade' THEN 'system' ELSE "update_by" END
WHERE "id" = '1568509614c245a39ce53bda9c3c2ec1';

UPDATE "public"."app_builder_app"
SET
    "create_by" = CASE WHEN "create_by" = 'Jade' THEN 'system' ELSE "create_by" END,
    "update_by" = CASE WHEN "update_by" = 'Jade' THEN 'system' ELSE "update_by" END
WHERE "id" = 'cec6bfe7cb3a444f8a26a97ea513e501';

UPDATE "public"."app_builder_config"
SET
    "create_by" = CASE WHEN "create_by" = 'Jade' THEN 'system' ELSE "create_by" END,
    "update_by" = CASE WHEN "update_by" = 'Jade' THEN 'system' ELSE "update_by" END
WHERE "id" = '99bc4eda890041878bc0e4fe13114956';

UPDATE "public"."app_builder_flow_graph"
SET
    "create_by" = CASE WHEN "create_by" = 'Jade' THEN 'system' ELSE "create_by" END,
    "update_by" = CASE WHEN "update_by" = 'Jade' THEN 'system' ELSE "update_by" END
WHERE "id" = 'df3c7df760964d08b092f7c9d0eb9513';

UPDATE "public"."task_new"
SET
    "created_by" = CASE WHEN "created_by" = 'Jade' THEN 'system' ELSE "created_by" END,
    "updated_by" = CASE WHEN "updated_by" = 'Jade' THEN 'system' ELSE "updated_by" END
WHERE "id" = '17997d19af65470d90f0581d8fa43834';

UPDATE "public"."flow_definition"
SET
    "created_by" = CASE WHEN "created_by" = 'Jade' THEN 'system' ELSE "created_by" END
WHERE "definition_id" = '502f4a99db924e75adf6d9f403c8b905';

UPDATE "public"."flow_graph"
SET
    "created_by" = CASE WHEN "created_by" = 'Jade' THEN 'system' ELSE "created_by" END,
    "updated_by" = CASE WHEN "updated_by" = 'Jade' THEN 'system' ELSE "updated_by" END
WHERE "id" = 'df3c7df760964d08b092f7c9d0eb9513';


-- 多版本功能
-- ## app_suite_id
ALTER TABLE app_builder_app ADD app_suite_id VARCHAR(32) NULL;
UPDATE app_builder_app
SET app_suite_id = task_new.template_id from task_new
where task_new.attributes->>'app_id' = app_builder_app.id and app_builder_app.is_deleted = 0;

-- ## is_active
ALTER TABLE app_builder_app
    ADD is_active bool NULL DEFAULT false;
UPDATE app_builder_app
SET is_active =
        CASE
            WHEN state = 'active' THEN
                true
            ELSE
                false
            END
WHERE 1 = 1;

-- ## status
ALTER TABLE app_builder_app
    ADD status varchar(16) NULL;
UPDATE app_builder_app
SET status =
        CASE
            WHEN state = 'active' THEN
                'published'
            ELSE
                'draft'
            END
WHERE 1 = 1;

-- ## uniqueName
ALTER TABLE app_builder_app
    ADD unique_name varchar(64) NULL;
UPDATE app_builder_app
SET unique_name = task_new.attributes->>'unique_name'
FROM task_new
WHERE app_builder_app.app_suite_id = task_new.template_id and app_builder_app.id = task_new.attributes->>'app_id' and app_builder_app.state = 'active' and task_new.version = app_builder_app.version;

-- ## publishAt
ALTER TABLE app_builder_app
    ADD publish_at timestamp(6) NULL;
UPDATE app_builder_app
SET publish_at = to_timestamp(task_new.attributes->>'publish_at', 'YYYY-MM-DD"T"HH24:MI:SS')
    FROM task_new
WHERE app_builder_app.app_suite_id = task_new.template_id and app_builder_app.id = task_new.attributes->>'app_id';

-- ## publish_description,publish_update_log
UPDATE app_builder_app
SET attributes = jsonb_set(app_builder_app.attributes::JSONB, '{publish_description}', coalesce(to_jsonb(task_new.attributes->>'publish_description'), '""'))
    FROM task_new
WHERE app_builder_app.app_suite_id = task_new.template_id and app_builder_app.id = task_new.attributes->>'app_id';

UPDATE app_builder_app
SET attributes = jsonb_set(app_builder_app.attributes::JSONB, '{publish_update_log}', coalesce(to_jsonb(task_new.attributes->>'publish_update_log'), '""'))
    FROM task_new
WHERE app_builder_app.app_suite_id = task_new.template_id and app_builder_app.id = task_new.attributes->>'app_id';

-- ## app_id
ALTER TABLE app_builder_app
    ADD app_id varchar(64) NULL;
UPDATE app_builder_app
SET app_id = id
WHERE 1 = 1;


-- ## 并行节点功能
INSERT INTO "public"."store_plugin" ("plugin_id", "plugin_name", "extension", "deploy_status", "is_builtin", "source", "icon") VALUES ('d44a239ed854ef94af0f032a526907e20ba8a56ebb4f851cc6956c0172a144e7', '并行', '{"uniqueness.groupId":"modelengine.fit.jade.plugin","pluginFullName":"aipp-parallel-tool-1.0.0-SNAPSHOT_1745841582889.jar","checksum":"42266c0ada1415feb0b689f288b4063b9406506ff7da16eca0332b91a01df20e","name":"并行","description":"并行执行工具","uniqueness.artifactId":"aipp-parallel-tool","type":"java"}', 'DEPLOYED', 't', '', NULL) ON CONFLICT ("plugin_id") DO NOTHING;

INSERT INTO "public"."store_plugin_tool" ("tool_name", "plugin_id", "tool_unique_name") VALUES ('parallelToolDefault', 'd44a239ed854ef94af0f032a526907e20ba8a56ebb4f851cc6956c0172a144e7', '1d0c8164-1aea-4264-879f-2c7898d13fb9') ON CONFLICT ("plugin_id", "tool_unique_name") DO NOTHING;

INSERT INTO "public"."store_definition" ("name", "schema", "definition_group_name") VALUES ('parallelTool', '{"name":"parallelTool","description":"用于并行执行工具","parameters":{"type":"object","properties":{"toolCalls":{"defaultValue":"","description":"并行调用的工具列表","name":"toolCalls","type":"array","items":{"type":"object","properties":{"uniqueName":{"type":"string"},"args":{"type":"object"},"outputName":{"type":"string"}}},"examples":"","required":[]},"config":{"defaultValue":"","description":"并行调用的配置","name":"config","type":"object","properties":{"concurrency":{"type":"integer"}},"examples":"","required":[]},"context":{"defaultValue":"","description":"调用时的上下文信息","name":"context","type":"object","examples":"","required":[]}},"required":["toolCalls"]},"order":["toolCalls","config","context"],"parameterExtensions":null,"return":{"type":"object","convertor":""}}', 'ParallelTool') ON CONFLICT ("definition_group_name", "name") DO NOTHING;

INSERT INTO "public"."store_tag" ("tool_unique_name", "name") VALUES ('1d0c8164-1aea-4264-879f-2c7898d13fb9', 'FIT') ON CONFLICT ("tool_unique_name", "name") DO NOTHING;
INSERT INTO "public"."store_tag" ("tool_unique_name", "name") VALUES ('1d0c8164-1aea-4264-879f-2c7898d13fb9', 'PARALLELNODESTATE') ON CONFLICT ("tool_unique_name", "name") DO NOTHING;
INSERT INTO "public"."store_tag" ("tool_unique_name", "name") VALUES ('1d0c8164-1aea-4264-879f-2c7898d13fb9', 'BASIC') ON CONFLICT ("tool_unique_name", "name") DO NOTHING;


INSERT INTO "public"."store_tool" ("name", "schema", "runnables", "extensions", "unique_name", "version", "is_latest", "group_name", "definition_name", "definition_group_name") VALUES ('parallelToolDefault', '{"name":"parallelTool","description":"用于并行执行工具","parameters":{"type":"object","properties":{"toolCalls":{"defaultValue":"","description":"并行调用的工具列表","name":"toolCalls","type":"array","items":{"type":"object","properties":{"uniqueName":{"type":"string"},"args":{"type":"object"},"outputName":{"type":"string"}}},"examples":"","required":[]},"config":{"defaultValue":"","description":"并行调用的配置","name":"config","type":"object","properties":{"concurrency":{"type":"integer"}},"examples":"","required":[]},"context":{"defaultValue":"","description":"调用时的上下文信息","name":"context","type":"object","examples":"","required":[]}},"required":["toolCalls"]},"order":["toolCalls","config","context"],"parameterExtensions":null,"return":{"type":"object","convertor":""}}', '{"FIT":{"genericableId":"modelengine.fit.jade.aipp.tool.parallel","fitableId":"default"}}', '{"tags":["FIT","BASIC","PARALLELNODESTATE"]}', '1d0c8164-1aea-4264-879f-2c7898d13fb9', '1.0.0', 't', 'ParallelToolImpl', 'parallelTool', 'ParallelTool')  ON CONFLICT ("unique_name", "version") DO NOTHING;

-- ## 处理工具流模型名问题
update app_builder_flow_graph set appearance = '{"id":"9fd1e6736e734fc085a5ea34f4ba1b21","title":"9fd1e6736e734fc085a5ea34f4ba1b21","source":"elsa","type":"jadeFlowGraph","tenant":"default","setting":{"borderColor":"#047bfc","shadow":"","underline":false,"selectable":true,"fontFace":"arial","pDock":"none","headColor":"steelblue","itemScroll":{"x":0,"y":0},"vAlign":"top","cornerRadius":4,"rotateAble":true,"pad":10,"infoType":{"next":"INFORMATION","name":"none"},"focusMargin":0,"progressStatus":{"next":"UNKNOWN","color":"gray","name":"NONE"},"focusBackColor":"whitesmoke","tag":{},"captionfontColor":"whitesmoke","fontWeight":"lighter","captionlineHeight":1,"margin":25,"itemPad":[5,5,5,5],"autoHeight":false,"visible":true,"rotateDegree":0,"focusBorderColor":"#047bfc","priority":0,"fontStyle":"normal","backColor":"whitesmoke","captionfontFace":"arial black","dockMode":"none","dashWidth":0,"fontSize":12,"mouseInFontColor":"orange","resizeable":true,"captionfontWeight":"lighter","mouseInBorderColor":"#047bfc","autoText":false,"showedProgress":false,"shared":false,"code":"","hAlign":"center","deletable":true,"numberedList":false,"shadowData":"2px 2px 4px","focusBorderWidth":1,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","allowLink":true,"lineWidth":2,"captionhAlign":"center","dragable":true,"focusShadow":"","emphasized":false,"borderWidth":1,"globalAlpha":1,"bulletedList":false,"enableAnimation":false,"autoWidth":false,"captionfontSize":14,"progressPercent":0.65,"strikethrough":false,"backAlpha":0.15,"focusFontColor":"darkorange","outstanding":false,"editable":true,"moveable":true,"captionfontStyle":"normal","mouseInColor":"orange","bulletSpeed":1,"enableSocial":true,"scrollLock":{"x":false,"y":false},"lineHeight":1.5,"fontColor":"steelblue","mouseInBackColor":"whitesmoke"},"pages":[{"x":297.46031746031747,"y":121.01190476190482,"id":"elsa-page:tvp1s6","bold":false,"mode":"configuration","text":"newFlowPage","type":"jadeFlowPage","dirty":false,"index":0,"width":1600,"hAlign":"left","height":800,"isPage":true,"italic":false,"scaleX":0.8,"scaleY":0.8,"vAlign":"top","itemPad":[0,0,0,0],"division":-1,"dockMode":"none","fontFace":"arial","fontSize":18,"hideText":true,"moveable":true,"shapesAs":{},"backColor":"#fbfbfc","container":"elsa-page:tvp1s6","dockAlign":"top","fontColor":"#ECD0A7","fontStyle":"normal","itemSpace":5,"namespace":"jadeFlow","fontWeight":"bold","itemScroll":{"x":0,"y":0},"borderColor":"white","focusBackColor":"#fbfbfc","shapes":[{"x":776.6424894555158,"y":415.53564816787656,"id":"jade1p0cdu","pad":0,"bold":false,"text":"","type":"jadeEvent","dirty":true,"index":-98,"textX":0,"textY":0,"width":314.07170053851075,"hAlign":"center","height":-20.607221568854584,"italic":false,"margin":20,"toShape":"jadesoux5i","endArrow":true,"hideText":true,"lineMode":{"type":"auto_curve"},"allowLink":false,"backColor":"white","container":"elsa-page:tvp1s6","fromShape":"jadewdnjbq","lineWidth":2,"namespace":"flowable","beginArrow":false,"borderColor":"#B1B1B7","borderWidth":1,"curvePoint1":{"x":0,"y":0},"curvePoint2":{"x":0,"y":0},"brokenPoints":[{"x":50,"y":0},{"x":50,"y":80}],"endArrowSize":4,"arrowEndPoint":{"x":96,"y":80,"direction":{"ax":"x","key":"W","color":"whitesmoke","value":"W","cursor":"ew-resize","vector":-1}},"endArrowEmpty":false,"beginArrowSize":4,"arrowBeginPoint":{"x":0,"y":0,"direction":{"ax":"x","key":"E","color":"whitesmoke","value":"E","cursor":"ew-resize","vector":1}},"beginArrowEmpty":false,"definedToConnector":"W","mouseInBorderColor":"#B1B1B7","allowSwitchLineMode":false,"definedFromConnector":"E","runnable":true},{"x":-88.39275686449133,"y":32.5,"id":"jade6qm5eg","pad":6,"bold":false,"text":"开始","type":"startNodeStart","dirty":true,"index":103,"width":360,"height":700,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","flowMeta":{"inputParams":[{"id":"91138f09-b635-43df-95c6-1fe3d1745829","from":"Expand","name":"input","type":"Object","value":[{"id":"input_ae2ffd6e-2b9e-4e73-9d7f-0e661ec3dbdb","from":"Input","name":"Question","type":"String","value":"","description":"这是用户输入的问题","disableModifiable":true}],"config":[{"allowAdd":true}]},{"id":"4a770dc6-e3c9-475d-84c7-48dacc74a5b6","from":"Expand","name":"memory","type":"Object","value":[{"id":"a7675623-7fc7-468c-8910-e73c70e5e468","from":"Input","name":"memorySwitch","type":"Boolean","value":true},{"id":"cee9a31b-781c-4835-a616-ceed73be22f2","from":"Input","name":"type","type":"String","value":"ByConversationTurn"},{"id":"69592622-4291-409d-9d65-9faea83db657","from":"Input","name":"value","type":"Integer","value":"3"}]}],"triggerMode":"auto"},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"deletable":false,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"outlineColor":"rgba(74,147,255,0.12)","outlineWidth":10,"completedTask":0,"componentName":"startComponent","focusBackColor":"white","sourcePlatform":"official","enableAnimation":false,"mouseInBorderColor":"rgba(28,31,35,.08)","runnable":true},{"x":416.64248945551583,"y":-79.46435183212344,"id":"jadewdnjbq","pad":6,"bold":false,"text":"大模型","type":"llmNodeState","dirty":true,"index":105,"width":360,"height":990,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","flowMeta":{"jober":{"name":"","type":"general_jober","isAsync":"true","fitables":["modelengine.fit.jober.aipp.fitable.LLMComponent"],"converter":{"type":"mapping_converter","entity":{"inputParams":[{"id":"31ba235d-1b26-4780-a7a7-32eca9500919","name":"accessInfo","type":"Object","from":"Expand","value":[{"id":"83653b54-dd04-4da9-957d-adb7c2728632","name":"serviceName","type":"String","from":"Input","value":"#app_builder_default_model_name#"},{"id":"dd588a17-a69c-40c0-859a-d9930202a148","name":"tag","type":"String","from":"Input","value":"#app_builder_default_tag#"}]}, {"id":"6c414e75-971e-403a-b2b1-c6850f128cc4","from":"Input","name":"model","type":"String","value":"#app_builder_default_model_name#"},{"id":"db5fdafa-4cbf-44ba-9cca-8a98f1f771f4","from":"Input","name":"temperature","type":"Number","value":"0.3"},{"id":"88f74d78-4711-4f81-a2e7-74d0034c5e88","from":"Expand","name":"prompt","type":"Object","value":[{"id":"35a710cf-1b79-4523-b16f-b50878d677fe","from":"Input","name":"template","type":"String","value":"请按照以下步骤生成您的回复：\n1. 递归地将问题分解为更小的问题。\n2. 对于每个原子问题，从上下文和对话历史记录中选择最相关的信息。\n3. 使用所选信息生成回复草稿。\n4. 删除回复草稿中的重复内容。\n5. 在调整后生成最终答案，以提高准确性和相关性。\n6. 请注意，只需要回复最终答案。\n-------------------------------------\n上下文信息：\n\n问题：{{query}}"},{"id":"38fb27a1-71f4-4fcc-87d5-9d8a880bc04d","from":"Expand","name":"variables","type":"Object","value":[{"id":"eee66922-4304-4209-89fc-b13ffa101630","from":"Reference","name":"query","type":"String","value":["Question"],"referenceId":"input_ae2ffd6e-2b9e-4e73-9d7f-0e661ec3dbdb","referenceKey":"Question","referenceNode":"jade6qm5eg"}]}]},{"id":"a6865419-867c-4bfb-855c-f5c1876c965a","from":"Expand","name":"tools","type":"Array","value":[]},{"id":"308e2023-a8e9-486e-9784-8680addbb786","from":"Expand","name":"workflows","type":"Array","value":[]},{"id":"68f92923-d5da-42ce-8478-d7ac7d90664e","from":"Input","name":"systemPrompt","type":"String","value":""},{"id":"58852742-5484-4870-9da0-65a7e41565ca","name":"maxMemoryRounds","type":"Integer","from":"input","value":"0"},{"id":"112405a9-cccb-4e3a-968e-0ef7ae81667a","from":"input","name":"enableLog","type":"Boolean","value":true}],"outputParams":[{"id":"95d84d67-3198-415e-a63c-bc9a2da8d821","from":"Expand","name":"output","type":"Object","value":[{"id":"272c927a-9e25-48b6-a921-6a8ab20267a4","from":"Input","name":"llmOutput","type":"String","value":"","description":""}]}]}}},"triggerMode":"auto"},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"outlineColor":"rgba(74,147,255,0.12)","outlineWidth":10,"completedTask":0,"componentName":"llmComponent","focusBackColor":"white","sourcePlatform":"official","enableAnimation":false,"mouseInBorderColor":"rgba(28,31,35,.08)","runnable":true},{"x":1090.7141899940266,"y":248.92842659902198,"id":"jadesoux5i","pad":6,"bold":false,"text":"结束","type":"endNodeEnd","dirty":true,"index":106,"width":360,"height":292,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","flowMeta":{"callback":{"name":"通知回调","type":"general_callback","fitables":["modelengine.fit.jober.aipp.fitable.AippFlowEndCallback"],"converter":{"type":"mapping_converter","entity":{"inputParams":[{"id":"fae1b650-075d-497d-a2b3-755ab315dca9","from":"Reference","name":"finalOutput","type":"String", "referenceNode":"jadewdnjbq","referenceId":"272c927a-9e25-48b6-a921-6a8ab20267a4","referenceKey":"llmOutput","value":["output","llmOutput"],"editable":true,"isRequired":false},{"id": "c4469c16-88a7-4575-b339-9a06e3305f3b","from": "Input","name": "enableLog","type": "Boolean","value": false}],"outputParams":[{}]}}},"triggerMode":"auto"},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"deletable":true,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"outlineColor":"rgba(74,147,255,0.12)","outlineWidth":10,"completedTask":0,"componentName":"endComponent","focusBackColor":"white","sourcePlatform":"official","enableAnimation":false,"mouseInBorderColor":"rgba(28,31,35,.08)","runnable":true},{"type":"jadeEvent","container":"elsa-page:tvp1s6","id":"2bqgxs","text":"","namespace":"flowable","x":271.60724313550867,"y":382.5,"width":145.03524632000716,"height":33.03564816787656,"bold":false,"italic":false,"pad":0,"margin":20,"backColor":"white","hideText":true,"beginArrow":false,"beginArrowEmpty":false,"beginArrowSize":4,"endArrow":true,"endArrowEmpty":false,"endArrowSize":4,"textX":0,"textY":0,"hAlign":"center","lineWidth":2,"fromShape":"jade6qm5eg","toShape":"jadewdnjbq","definedFromConnector":"E","definedToConnector":"W","arrowBeginPoint":{"x":0,"y":0},"arrowEndPoint":{"x":0,"y":0},"curvePoint1":{"x":0,"y":0},"curvePoint2":{"x":0,"y":0},"brokenPoints":[],"lineMode":{"type":"auto_curve"},"allowSwitchLineMode":false,"allowLink":false,"borderWidth":1,"borderColor":"#B1B1B7","mouseInBorderColor":"#B1B1B7","runnable":true,"index":-96,"dirty":true}]}],"enableText":false,"flowMeta":{"exceptionFitables":["modelengine.fit.jober.aipp.fitable.AippFlowExceptionHandler","modelengine.fit.jober.fitable.FlowInfoException"],"enableOutputScope":true,"callback":{"fitables":["modelengine.fit.jober.fitable.FlowInfoCallback"],"name":"通知回调","type":"general_callback"}}}' where id = '9997f1555b41452b924d1a8b2229bde4';
update app_builder_flow_graph set appearance = '{"id":"beefffd1168b4785a71f149a2a530d2f","type":"jadeFlowGraph","pages":[{"x":176.21031746031747,"y":-46.488095238095184,"id":"elsa-page:tvp1s6","bold":false,"mode":"configuration","text":"newFlowPage","type":"jadeFlowPage","dirty":true,"index":0,"width":1600,"hAlign":"left","height":800,"isPage":true,"italic":false,"scaleX":0.8,"scaleY":0.8,"shapes":[{"x":-145.8928571428571,"y":230,"id":"jade6qm5eg","pad":6,"bold":false,"text":"开始","type":"startNodeStart","dirty":true,"index":101,"width":360,"height":528,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","sourcePlatform":"official","flowMeta":{"inputParams":[{"id":"91138f09-b635-43df-95c6-1fe3d1745829","from":"Expand","name":"input","type":"Object","value":[{"id":"input_ae2ffd6e-2b9e-4e73-9d7f-0e661ec3dbdb","from":"Input","name":"query","type":"String","value":"","description":"用户问题。"}],"config":[{"allowAdd":true}]},{"id":"4a770dc6-e3c9-475d-84c7-48dacc74a5b6","from":"Expand","name":"memory","type":"Object","value":[{"id":"a7675623-7fc7-468c-8910-e73c70e5e468","from":"Input","name":"memorySwitch","type":"Boolean","value":false},{"id":"cee9a31b-781c-4835-a616-ceed73be22f2","from":"Input","name":"type","type":"String","value":"ByConversationTurn"},{"id":"69592622-4291-409d-9d65-9faea83db657","from":"Input","name":"value","type":"Integer","value":"3"}]}],"triggerMode":"auto"},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"deletable":false,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"completedTask":0,"componentName":"startComponent","focusBackColor":"white","enableAnimation":false,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBorderColor":"rgba(28,31,35,.08)"},{"x":2334.464285714285,"y":378.9285714285713,"id":"jadesoux5i","pad":6,"bold":false,"text":"财经问答结束","type":"endNodeEnd","dirty":true,"index":102,"width":360,"height":214,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","sourcePlatform":"official","flowMeta":{"callback":{"name":"通知回调","type":"general_callback","fitables":["modelengine.fit.jober.aipp.fitable.AippFlowEndCallback"],"converter":{"type":"mapping_converter","entity":{"inputParams":[{"id":"ffad80c2-3f60-4d57-93b2-c2362a5dab9c","from":"Reference","name":"finalOutput","type":"String","value":["output"],"referenceId":"output_fc952038-1a14-442b-bd78-8515e69449fa","referenceKey":"output","referenceNode":"jadecoarmv"}],"outputParams":[{}]}}},"triggerMode":"auto"},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"deletable":true,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"completedTask":0,"componentName":"endComponent","focusBackColor":"white","enableAnimation":false,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBorderColor":"rgba(28,31,35,.08)"},{"x":291.28968253968253,"y":366.4880952380952,"id":"jade3axbnw","pad":6,"bold":false,"text":"问题路由","type":"toolInvokeNodeState","dirty":true,"index":102,"width":360,"height":259,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","sourcePlatform":"official","flowMeta":{"jober":{"name":"","type":"STORE_JOBER","entity":{"params":[{"name":"query"}],"return":{"type":"object"},"uniqueName":"c6c2d272-90e5-4c06-b8fa-5d94930b7532"},"fitables":[],"converter":{"type":"mapping_converter","entity":{"inputParams":[{"id":"query_c958c2fd-b97e-481f-8cff-55e7d8564d5d","from":"Reference","name":"query","type":"String","value":["query"],"referenceId":"input_ae2ffd6e-2b9e-4e73-9d7f-0e661ec3dbdb","referenceKey":"query","referenceNode":"jade6qm5eg"}],"outputParams":[{"id":"output_2d3a958f-ac5c-413f-bf27-e39425597f72","name":"output","type":"Object","value":[{"id":"b290d85f-2c2e-426d-9789-1ffbdd492a2b","name":"result","type":"String","value":"String"},{"id":"4b5ec0f1-33e5-4bb4-bf83-df410be25b14","name":"matched","type":"Boolean","value":"Boolean"},{"id":"92a77575-7d95-4e51-ab3b-7ce14385b2d4","name":"completeQuery","type":"String","value":"String"}]}]}}},"triggerMode":"auto","joberFilter":{"type":"MINIMUM_SIZE_FILTER","threshold":1}},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"completedTask":0,"componentName":"toolInvokeComponent","focusBackColor":"white","enableAnimation":false,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBorderColor":"rgba(28,31,35,.08)"},{"x":1868.7896825396824,"y":343.9880952380952,"id":"jadecoarmv","pad":6,"bold":false,"text":"结果生成","type":"toolInvokeNodeState","dirty":true,"index":103,"width":360,"height":304,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","sourcePlatform":"official","flowMeta":{"jober":{"name":"","type":"STORE_JOBER","entity":{"params":[{"name":"condition"},{"name":"query"}],"return":{"type":"string"},"uniqueName":"24474301-937a-4335-a155-1e86d1a48de0"},"fitables":[],"converter":{"type":"mapping_converter","entity":{"inputParams":[{"id":"condition_b63e38ea-b27e-4895-b2d8-de84384fae2e","from":"Reference","name":"condition","type":"String","value":["output","llmOutput"],"referenceId":"8e900cd6-d151-402b-b6b2-194790edf467","referenceKey":"llmOutput","referenceNode":"jade5wc1ee"},{"id":"query_88827f8c-a610-46b7-8b50-4531bb87763f","from":"Reference","name":"query","type":"String","value":["query"],"referenceId":"input_ae2ffd6e-2b9e-4e73-9d7f-0e661ec3dbdb","referenceKey":"query","referenceNode":"jade6qm5eg"}],"outputParams":[{"id":"output_fc952038-1a14-442b-bd78-8515e69449fa","name":"output","type":"String","value":[]}]}}},"triggerMode":"auto","joberFilter":{"type":"MINIMUM_SIZE_FILTER","threshold":1}},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"completedTask":0,"componentName":"toolInvokeComponent","focusBackColor":"white","enableAnimation":false,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBorderColor":"rgba(28,31,35,.08)"},{"x":726.2896825396825,"y":317.7380952380952,"id":"jadelh4543","pad":6,"bold":false,"text":"条件","type":"conditionNodeCondition","dirty":true,"index":104,"width":600,"height":357,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","sourcePlatform":"official","flowMeta":{"triggerMode":"auto","conditionParams":{"branches":[{"id":"ad2e05b6-593a-4d86-81e0-1b1b504c2795","type":"if","conditions":[{"id":"5d96df3a-5192-4de8-9743-63cf9f0259ec","value":[{"id":"3fc094bc-8496-4e7e-a940-97b092d7e67d","from":"Reference","name":"left","type":"Boolean","value":["output","matched"],"referenceId":"4b5ec0f1-33e5-4bb4-bf83-df410be25b14","referenceKey":"matched","referenceNode":"jade3axbnw"},{"id":"f770e6fe-a612-4fb8-8c40-d51bcef05baf","from":"Reference","name":"right","type":"","value":"","referenceId":"","referenceKey":"","referenceNode":""}],"condition":"is true"}],"conditionRelation":"and"}]},"joberFilter":{"type":"MINIMUM_SIZE_FILTER","threshold":1}},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"completedTask":0,"componentName":"conditionComponent","focusBackColor":"white","enableAnimation":false,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBorderColor":"rgba(28,31,35,.08)"},{"x":1405.0396825396824,"y":56.488095238095184,"id":"jade5wc1ee","pad":6,"bold":false,"text":"财经问题专属模型","type":"llmNodeState","dirty":true,"index":105,"width":360,"height":851,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","sourcePlatform":"official","flowMeta":{"jober":{"name":"","type":"general_jober","isAsync":"true","fitables":["modelengine.fit.jober.aipp.fitable.LLMComponent"],"converter":{"type":"mapping_converter","entity":{"inputParams":[{"id":"31ba235d-1b26-4780-a7a7-32eca9500919","name":"accessInfo","type":"Object","from":"Expand","value":[{"id":"83653b54-dd04-4da9-957d-adb7c2728632","name":"serviceName","type":"String","from":"Input","value":"#app_builder_default_model_name#"},{"id":"dd588a17-a69c-40c0-859a-d9930202a148","name":"tag","type":"String","from":"Input","value":"#app_builder_default_tag#"}]},{"id":"c490ace3-472c-4c95-bf29-760982f62c64","from":"Input","name":"model","type":"String","value":"#app_builder_default_model_name#"},{"id":"c1ea0b9c-97c9-466e-bd42-b0eb6046dc3a","from":"Input","name":"temperature","type":"Number","value":"0"},{"id":"89cda9b5-f975-42ba-a426-a83a6cbdddb3","from":"Expand","name":"prompt","type":"Object","value":[{"id":"12fe982a-0fbd-4461-a159-51e09de31dc0","from":"Input","name":"template","type":"String","value":"{{query}}"},{"id":"6e78da7c-3d62-4df8-98cf-310b06691a4e","from":"Expand","name":"variables","type":"Object","value":[{"id":"1ec181db-eed1-4089-a580-f656de258322","from":"Reference","name":"query","type":"String","value":["output","result"],"referenceId":"b290d85f-2c2e-426d-9789-1ffbdd492a2b","referenceKey":"result","referenceNode":"jade3axbnw"}]}]},{"id":"a5f228f5-167e-4fbc-8114-69bcd9c76a4c","from":"Expand","name":"tools","type":"Array","value":[]},{"id":"f548ab63-9add-4053-a3a6-cb7682c362af","from":"Expand","name":"workflows","type":"Array","value":[]},{"id":"4ff72b6e-18b8-430c-a509-d1bf8a53bbe5","from":"Input","name":"systemPrompt","type":"String","value":""}],"outputParams":[{"id":"8cc96b96-765d-4f13-ba10-d9dff76a2615","from":"Expand","name":"output","type":"Object","value":[{"id":"8e900cd6-d151-402b-b6b2-194790edf467","from":"Input","name":"llmOutput","type":"String","value":"","description":""}]}]}}},"triggerMode":"auto","joberFilter":{"type":"MINIMUM_SIZE_FILTER","threshold":1}},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"completedTask":0,"componentName":"llmComponent","focusBackColor":"white","enableAnimation":false,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBorderColor":"rgba(28,31,35,.08)"},{"x":1410.0396825396824,"y":1000.2380952380952,"id":"jaded1ufou","pad":6,"bold":false,"text":"普通问答模型","type":"llmNodeState","dirty":true,"index":106,"width":360,"height":851,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","sourcePlatform":"official","flowMeta":{"jober":{"name":"","type":"general_jober","isAsync":"true","fitables":["modelengine.fit.jober.aipp.fitable.LLMComponent"],"converter":{"type":"mapping_converter","entity":{"inputParams":[{"id":"31ba235d-1b26-4780-a7a7-32eca9500919","name":"accessInfo","type":"Object","from":"Expand","value":[{"id":"83653b54-dd04-4da9-957d-adb7c2728632","name":"serviceName","type":"String","from":"Input","value":"#app_builder_default_model_name#"},{"id":"dd588a17-a69c-40c0-859a-d9930202a148","name":"tag","type":"String","from":"Input","value":"#app_builder_default_tag#"}]},{"id":"f9586db3-72f9-4d33-9f01-893bbfa61277","from":"Input","name":"model","type":"String","value":"#app_builder_default_model_name#"},{"id":"e0b992c2-739a-43b1-9cbc-b6747eb7592f","from":"Input","name":"temperature","type":"Number","value":"0.3"},{"id":"95ba86be-5c03-4258-b5ce-32b0eae17b5c","from":"Expand","name":"prompt","type":"Object","value":[{"id":"123d6c59-c525-4100-a66b-72b1a2c4e625","from":"Input","name":"template","type":"String","value":"{{query}}"},{"id":"892b3e12-2895-4e79-b668-5d6a6bd79fe6","from":"Expand","name":"variables","type":"Object","value":[{"id":"c779f80b-c15f-416d-ad1b-6628cb24fe8c","from":"Reference","name":"query","type":"String","value":["query"],"referenceId":"input_ae2ffd6e-2b9e-4e73-9d7f-0e661ec3dbdb","referenceKey":"query","referenceNode":"jade6qm5eg"}]}]},{"id":"a4e83ae4-4f4b-4407-a2bc-a9570886329e","from":"Expand","name":"tools","type":"Array","value":[]},{"id":"08297d4d-4f38-44c0-b049-638a2008a884","from":"Expand","name":"workflows","type":"Array","value":[]},{"id":"f4fd8b0a-aeaf-47e2-8914-5501ba5bb4b1","from":"Input","name":"systemPrompt","type":"String","value":""}],"outputParams":[{"id":"9024f034-bacc-4ac0-812f-e270fa6997b9","from":"Expand","name":"output","type":"Object","value":[{"id":"6f0fdf98-24ee-4ef0-bd62-9d4f1b1cb6ac","from":"Input","name":"llmOutput","type":"String","value":"","description":""}]}]}}},"triggerMode":"auto","joberFilter":{"type":"MINIMUM_SIZE_FILTER","threshold":1}},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"completedTask":0,"componentName":"llmComponent","focusBackColor":"white","enableAnimation":false,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBorderColor":"rgba(28,31,35,.08)"},{"x":1901.2896825396824,"y":1336.4880952380952,"id":"jadela7k5y","pad":6,"bold":false,"text":"普通问答结束","type":"endNodeEnd","dirty":true,"index":107,"width":360,"height":214,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","sourcePlatform":"official","flowMeta":{"callback":{"name":"通知回调","type":"general_callback","fitables":["modelengine.fit.jober.aipp.fitable.AippFlowEndCallback"],"converter":{"type":"mapping_converter","entity":{"inputParams":[{"id":"e09784cb-3ae9-4581-aa63-1b83f09fd7ed","from":"Reference","name":"finalOutput","type":"String","value":["output","llmOutput"],"referenceId":"6f0fdf98-24ee-4ef0-bd62-9d4f1b1cb6ac","referenceKey":"llmOutput","referenceNode":"jaded1ufou"}],"outputParams":[{}]}}},"triggerMode":"auto"},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"completedTask":0,"componentName":"endComponent","focusBackColor":"white","enableAnimation":false,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBorderColor":"rgba(28,31,35,.08)"},{"x":214.1071428571429,"y":494,"id":"4iyvh1","pad":0,"bold":false,"text":"","type":"jadeEvent","dirty":true,"index":-92,"textX":0,"textY":0,"width":77.18253968253964,"hAlign":"center","height":1.988095238095184,"italic":false,"margin":20,"toShape":"jade3axbnw","endArrow":true,"hideText":true,"lineMode":{"type":"auto_curve"},"allowLink":false,"backColor":"white","container":"elsa-page:tvp1s6","fromShape":"jade6qm5eg","lineWidth":2,"namespace":"flowable","beginArrow":false,"borderColor":"#B1B1B7","borderWidth":1,"curvePoint1":{"x":0,"y":0},"curvePoint2":{"x":0,"y":0},"brokenPoints":[],"endArrowSize":4,"arrowEndPoint":{"x":0,"y":0},"endArrowEmpty":false,"beginArrowSize":4,"arrowBeginPoint":{"x":0,"y":0},"beginArrowEmpty":false,"definedToConnector":"W","mouseInBorderColor":"#B1B1B7","allowSwitchLineMode":false,"definedFromConnector":"E"},{"x":651.2896825396825,"y":495.9880952380952,"id":"6rh9x7","pad":0,"bold":false,"text":"","type":"jadeEvent","dirty":true,"index":-91,"textX":0,"textY":0,"width":75,"hAlign":"center","height":0.25,"italic":false,"margin":20,"toShape":"jadelh4543","endArrow":true,"hideText":true,"lineMode":{"type":"auto_curve"},"allowLink":false,"backColor":"white","container":"elsa-page:tvp1s6","fromShape":"jade3axbnw","lineWidth":2,"namespace":"flowable","beginArrow":false,"borderColor":"#B1B1B7","borderWidth":1,"curvePoint1":{"x":0,"y":0},"curvePoint2":{"x":0,"y":0},"brokenPoints":[],"endArrowSize":4,"arrowEndPoint":{"x":0,"y":0},"endArrowEmpty":false,"beginArrowSize":4,"arrowBeginPoint":{"x":0,"y":0},"beginArrowEmpty":false,"definedToConnector":"W","mouseInBorderColor":"#B1B1B7","allowSwitchLineMode":false,"definedFromConnector":"E"},{"x":1313.2897283160496,"y":512.7380952380952,"id":"vosd6p","pad":0,"bold":false,"text":"","type":"jadeEvent","dirty":true,"index":-90,"textX":0,"textY":0,"width":91.74995422363281,"hAlign":"center","height":-30.75,"italic":false,"margin":20,"toShape":"jade5wc1ee","endArrow":true,"hideText":true,"lineMode":{"type":"auto_curve"},"allowLink":false,"backColor":"white","container":"elsa-page:tvp1s6","fromShape":"jadelh4543","lineWidth":2,"namespace":"flowable","beginArrow":false,"borderColor":"#B1B1B7","borderWidth":1,"curvePoint1":{"x":0,"y":0},"curvePoint2":{"x":0,"y":0},"brokenPoints":[],"endArrowSize":4,"arrowEndPoint":{"x":0,"y":0},"endArrowEmpty":false,"beginArrowSize":4,"arrowBeginPoint":{"x":0,"y":0},"beginArrowEmpty":false,"definedToConnector":"W","mouseInBorderColor":"#B1B1B7","allowSwitchLineMode":false,"definedFromConnector":"dynamic-0"},{"x":1765.0396825396824,"y":481.9880952380952,"id":"4qny17","pad":0,"bold":false,"text":"","type":"jadeEvent","dirty":true,"index":-89,"textX":0,"textY":0,"width":103.75,"hAlign":"center","height":14,"italic":false,"margin":20,"toShape":"jadecoarmv","endArrow":true,"hideText":true,"lineMode":{"type":"auto_curve"},"allowLink":false,"backColor":"white","container":"elsa-page:tvp1s6","fromShape":"jade5wc1ee","lineWidth":2,"namespace":"flowable","beginArrow":false,"borderColor":"#B1B1B7","borderWidth":1,"curvePoint1":{"x":0,"y":0},"curvePoint2":{"x":0,"y":0},"brokenPoints":[],"endArrowSize":4,"arrowEndPoint":{"x":0,"y":0},"endArrowEmpty":false,"beginArrowSize":4,"arrowBeginPoint":{"x":0,"y":0},"beginArrowEmpty":false,"definedToConnector":"W","mouseInBorderColor":"#B1B1B7","allowSwitchLineMode":false,"definedFromConnector":"E"},{"x":2228.7896825396824,"y":495.9880952380952,"id":"0vxnrc","pad":0,"bold":false,"text":"","type":"jadeEvent","dirty":true,"index":-88,"textX":0,"textY":0,"width":105.67460317460245,"hAlign":"center","height":-10.05952380952391,"italic":false,"margin":20,"toShape":"jadesoux5i","endArrow":true,"hideText":true,"lineMode":{"type":"auto_curve"},"allowLink":false,"backColor":"white","container":"elsa-page:tvp1s6","fromShape":"jadecoarmv","lineWidth":2,"namespace":"flowable","beginArrow":false,"borderColor":"#B1B1B7","borderWidth":1,"curvePoint1":{"x":0,"y":0},"curvePoint2":{"x":0,"y":0},"brokenPoints":[],"endArrowSize":4,"arrowEndPoint":{"x":0,"y":0},"endArrowEmpty":false,"beginArrowSize":4,"arrowBeginPoint":{"x":0,"y":0},"beginArrowEmpty":false,"definedToConnector":"W","mouseInBorderColor":"#B1B1B7","allowSwitchLineMode":false,"definedFromConnector":"E"},{"x":1313.2897283160496,"y":632.1599778674897,"id":"v3a2mn","pad":0,"bold":false,"text":"","type":"jadeEvent","dirty":true,"index":-87,"textX":0,"textY":0,"width":96.74995422363281,"hAlign":"center","height":793.5781173706055,"italic":false,"margin":20,"toShape":"jaded1ufou","endArrow":true,"hideText":true,"lineMode":{"type":"auto_curve"},"allowLink":false,"backColor":"white","container":"elsa-page:tvp1s6","fromShape":"jadelh4543","lineWidth":2,"namespace":"flowable","beginArrow":false,"borderColor":"#B1B1B7","borderWidth":1,"curvePoint1":{"x":0,"y":0},"curvePoint2":{"x":0,"y":0},"brokenPoints":[],"endArrowSize":4,"arrowEndPoint":{"x":0,"y":0},"endArrowEmpty":false,"beginArrowSize":4,"arrowBeginPoint":{"x":0,"y":0},"beginArrowEmpty":false,"definedToConnector":"W","mouseInBorderColor":"#B1B1B7","allowSwitchLineMode":false,"definedFromConnector":"dynamic-2"},{"x":1770.0396825396824,"y":1425.7380952380952,"id":"fv8h4v","pad":0,"bold":false,"text":"","type":"jadeEvent","dirty":true,"index":-86,"textX":0,"textY":0,"width":131.25,"hAlign":"center","height":17.75,"italic":false,"margin":20,"toShape":"jadela7k5y","endArrow":true,"hideText":true,"lineMode":{"type":"auto_curve"},"allowLink":false,"backColor":"white","container":"elsa-page:tvp1s6","fromShape":"jaded1ufou","lineWidth":2,"namespace":"flowable","beginArrow":false,"borderColor":"#B1B1B7","borderWidth":1,"curvePoint1":{"x":0,"y":0},"curvePoint2":{"x":0,"y":0},"brokenPoints":[],"endArrowSize":4,"arrowEndPoint":{"x":0,"y":0},"endArrowEmpty":false,"beginArrowSize":4,"arrowBeginPoint":{"x":0,"y":0},"beginArrowEmpty":false,"definedToConnector":"W","mouseInBorderColor":"#B1B1B7","allowSwitchLineMode":false,"definedFromConnector":"E"}],"vAlign":"top","itemPad":[0,0,0,0],"division":-1,"dockMode":"none","fontFace":"arial","fontSize":18,"hideText":true,"moveable":true,"shapesAs":{},"backColor":"#fbfbfc","container":"elsa-page:tvp1s6","dockAlign":"top","fontColor":"#ECD0A7","fontStyle":"normal","itemSpace":5,"namespace":"jadeFlow","fontWeight":"bold","itemScroll":{"x":0,"y":0},"borderColor":"white","focusBackColor":"#fbfbfc"}],"title":"beefffd1168b4785a71f149a2a530d2f","source":"elsa","tenant":"default","setting":{"pad":10,"tag":{},"code":"","pDock":"none","hAlign":"center","margin":25,"shadow":"","shared":false,"vAlign":"top","itemPad":[5,5,5,5],"visible":true,"autoText":false,"dockMode":"none","dragable":true,"editable":true,"fontFace":"arial","fontSize":12,"infoType":{"name":"none","next":"INFORMATION"},"moveable":true,"priority":0,"allowLink":true,"autoWidth":false,"backAlpha":0.15,"backColor":"whitesmoke","dashWidth":0,"deletable":true,"fontColor":"steelblue","fontStyle":"normal","headColor":"steelblue","lineWidth":2,"underline":false,"autoHeight":false,"emphasized":false,"fontWeight":"lighter","itemScroll":{"x":0,"y":0},"lineHeight":1.5,"resizeable":true,"rotateAble":true,"scrollLock":{"x":false,"y":false},"selectable":true,"shadowData":"2px 2px 4px","borderColor":"#047bfc","borderWidth":1,"bulletSpeed":1,"focusMargin":0,"focusShadow":"","globalAlpha":1,"outstanding":false,"bulletedList":false,"cornerRadius":4,"enableSocial":true,"mouseInColor":"orange","numberedList":false,"rotateDegree":0,"captionhAlign":"center","strikethrough":false,"focusBackColor":"whitesmoke","focusFontColor":"darkorange","progressStatus":{"name":"NONE","next":"UNKNOWN","color":"gray"},"showedProgress":false,"captionfontFace":"arial black","captionfontSize":14,"enableAnimation":false,"progressPercent":0.65,"captionfontColor":"whitesmoke","captionfontStyle":"normal","focusBorderColor":"#047bfc","focusBorderWidth":1,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBackColor":"whitesmoke","mouseInFontColor":"orange","captionfontWeight":"lighter","captionlineHeight":1,"mouseInBorderColor":"#047bfc"},"flowMeta":{"enableOutputScope":true,"exceptionFitables":["modelengine.fit.jober.aipp.fitable.AippFlowExceptionHandler","modelengine.fit.jober.fitable.FlowInfoException"],"callback":{"fitables":["modelengine.fit.jober.fitable.FlowInfoCallback"],"name":"通知回调","type":"general_callback"}},"enableText":false}' where id = 'beefffd1168b4785a71f149a2a530d2f';
update app_builder_flow_graph set appearance = '{"id":"b2ecde0b919841f5867d2e89bb46095c","type":"jadeFlowGraph","pages":[{"x":297.46031746031747,"y":121.01190476190482,"id":"elsa-page:tvp1s6","bold":false,"mode":"configuration","text":"newFlowPage","type":"jadeFlowPage","dirty":false,"index":0,"width":1600,"hAlign":"left","height":800,"isPage":true,"italic":false,"scaleX":0.8,"scaleY":0.8,"shapes":[{"x":189.1071428571429,"y":296.5,"id":"jade2zanyx","pad":0,"bold":false,"text":"","type":"jadeEvent","dirty":true,"index":-100,"textX":0,"textY":0,"width":86.642857142857,"hAlign":"center","height":96.85714285714278,"italic":false,"margin":20,"toShape":"jade0pg2ag","endArrow":true,"hideText":true,"lineMode":{"type":"auto_curve"},"allowLink":false,"backColor":"white","container":"elsa-page:tvp1s6","fromShape":"jade6qm5eg","lineWidth":2,"namespace":"flowable","beginArrow":false,"borderColor":"#B1B1B7","borderWidth":1,"curvePoint1":{"x":0,"y":0},"curvePoint2":{"x":0,"y":0},"brokenPoints":[{"x":50,"y":0},{"x":50,"y":80}],"endArrowSize":4,"arrowEndPoint":{"x":96,"y":80,"direction":{"ax":"x","key":"W","color":"whitesmoke","value":"W","cursor":"ew-resize","vector":-1}},"endArrowEmpty":false,"beginArrowSize":4,"arrowBeginPoint":{"x":0,"y":0,"direction":{"ax":"x","key":"E","color":"whitesmoke","value":"E","cursor":"ew-resize","vector":1}},"beginArrowEmpty":false,"definedToConnector":"W","mouseInBorderColor":"#B1B1B7","allowSwitchLineMode":false,"definedFromConnector":"E"},{"x":635.7499999999999,"y":393.3571428571428,"id":"jade5c5urs","pad":0,"bold":false,"text":"","type":"jadeEvent","dirty":true,"index":-99,"textX":0,"textY":0,"width":83.39285714285722,"hAlign":"center","height":-0.5714285714285552,"italic":false,"margin":20,"toShape":"jadewdnjbq","endArrow":true,"hideText":true,"lineMode":{"type":"auto_curve"},"allowLink":false,"backColor":"white","container":"elsa-page:tvp1s6","fromShape":"jade0pg2ag","lineWidth":2,"namespace":"flowable","beginArrow":false,"borderColor":"#B1B1B7","borderWidth":1,"curvePoint1":{"x":0,"y":0},"curvePoint2":{"x":0,"y":0},"brokenPoints":[{"x":50,"y":0},{"x":50,"y":80}],"endArrowSize":4,"arrowEndPoint":{"x":96,"y":80,"direction":{"ax":"x","key":"W","color":"whitesmoke","value":"W","cursor":"ew-resize","vector":-1}},"endArrowEmpty":false,"beginArrowSize":4,"arrowBeginPoint":{"x":0,"y":0,"direction":{"ax":"x","key":"E","color":"whitesmoke","value":"E","cursor":"ew-resize","vector":1}},"beginArrowEmpty":false,"definedToConnector":"W","mouseInBorderColor":"#B1B1B7","allowSwitchLineMode":false,"definedFromConnector":"E"},{"x":1079.142857142857,"y":392.7857142857142,"id":"jade1p0cdu","pad":0,"bold":false,"text":"","type":"jadeEvent","dirty":true,"index":-98,"textX":0,"textY":0,"width":90.32142857142776,"hAlign":"center","height":20.642857142857054,"italic":false,"margin":20,"toShape":"jadesoux5i","endArrow":true,"hideText":true,"lineMode":{"type":"auto_curve"},"allowLink":false,"backColor":"white","container":"elsa-page:tvp1s6","fromShape":"jadewdnjbq","lineWidth":2,"namespace":"flowable","beginArrow":false,"borderColor":"#B1B1B7","borderWidth":1,"curvePoint1":{"x":0,"y":0},"curvePoint2":{"x":0,"y":0},"brokenPoints":[{"x":50,"y":0},{"x":50,"y":80}],"endArrowSize":4,"arrowEndPoint":{"x":96,"y":80,"direction":{"ax":"x","key":"W","color":"whitesmoke","value":"W","cursor":"ew-resize","vector":-1}},"endArrowEmpty":false,"beginArrowSize":4,"arrowBeginPoint":{"x":0,"y":0,"direction":{"ax":"x","key":"E","color":"whitesmoke","value":"E","cursor":"ew-resize","vector":1}},"beginArrowEmpty":false,"definedToConnector":"W","mouseInBorderColor":"#B1B1B7","allowSwitchLineMode":false,"definedFromConnector":"E"},{"x":-170.8928571428571,"y":32.5,"id":"jade6qm5eg","pad":6,"bold":false,"text":"开始","type":"startNodeStart","dirty":true,"index":103,"width":360,"height":528,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","sourcePlatform":"official","flowMeta":{"inputParams":[{"id":"91138f09-b635-43df-95c6-1fe3d1745829","from":"Expand","name":"input","type":"Object","value":[{"id":"input_ae2ffd6e-2b9e-4e73-9d7f-0e661ec3dbdb","from":"Input","name":"Question","type":"String","value":"","description":"i18n_appBuilder_{flow_graph_question_description}","disableModifiable":true}]},{"id":"4a770dc6-e3c9-475d-84c7-48dacc74a5b6","from":"Expand","name":"memory","type":"Object","value":[{"id":"a7675623-7fc7-468c-8910-e73c70e5e468","from":"Input","name":"memorySwitch","type":"Boolean","value":false},{"id":"cee9a31b-781c-4835-a616-ceed73be22f2","from":"Input","name":"type","type":"String","value":"ByConversationTurn"},{"id":"69592622-4291-409d-9d65-9faea83db657","from":"Input","name":"value","type":"Integer","value":"3"}]}],"triggerMode":"auto"},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"deletable":false,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"completedTask":0,"componentName":"startComponent","focusBackColor":"white","enableAnimation":false,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBorderColor":"rgba(28,31,35,.08)"},{"x":275.7499999999999,"y":192.3571428571428,"id":"jade0pg2ag","pad":6,"bold":false,"text":"普通检索","type":"retrievalNodeState","dirty":true,"index":104,"width":360,"height":402,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","sourcePlatform":"official","flowMeta":{"jober":{"name":"","type":"general_jober","fitables":["modelengine.fit.jober.aipp.fitable.NaiveRAGComponent"],"converter":{"type":"mapping_converter","entity":{"inputParams":[{"id":"query_0ab55575-f21d-4b19-9676-57fcb4b0b783","from":"Reference","name":"query","type":"String","value":["Question"],"referenceId":"input_ae2ffd6e-2b9e-4e73-9d7f-0e661ec3dbdb","referenceKey":"Question","referenceNode":"jade6qm5eg"},{"id":"knowledge_01c41edd-a22b-4289-b1cf-8db835833261","from":"Expand","name":"knowledge","type":"Array","value":[]},{"id":"maximum_2da115cd-c1ce-485f-ba98-b4c995f3d6ff","from":"Input","name":"maximum","type":"Integer","value":3}],"outputParams":[{"id":"output_cd5cbe89-0d9f-4cf1-9e09-afb325576b84","from":"Expand","name":"output","type":"Object","value":[{"id":"5c9c6535-c127-445a-862a-966cf1083929","from":"Input","name":"retrievalOutput","type":"String","value":"String"}]}]}}},"triggerMode":"auto","joberFilter":{"type":"MINIMUM_SIZE_FILTER","threshold":1}},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"completedTask":0,"componentName":"retrievalComponent","focusBackColor":"white","enableAnimation":false,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBorderColor":"rgba(28,31,35,.08)"},{"x":719.1428571428571,"y":-30.71403761434209,"id":"jadewdnjbq","pad":6,"bold":false,"text":"大模型","type":"llmNodeState","dirty":true,"index":105,"width":360,"height":892,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","sourcePlatform":"official","flowMeta":{"jober":{"name":"","type":"general_jober","isAsync":"true","fitables":["modelengine.fit.jober.aipp.fitable.LLMComponent"],"converter":{"type":"mapping_converter","entity":{"inputParams":[{"id":"31ba235d-1b26-4780-a7a7-32eca9500919","name":"accessInfo","type":"Object","from":"Expand","value":[{"id":"83653b54-dd04-4da9-957d-adb7c2728632","name":"serviceName","type":"String","from":"Input","value":"#app_builder_default_model_name#"},{"id":"dd588a17-a69c-40c0-859a-d9930202a148","name":"tag","type":"String","from":"Input","value":"#app_builder_default_tag#"}]},{"id":"6c414e75-971e-403a-b2b1-c6850f128cc4","from":"Input","name":"model","type":"String","value":"#app_builder_default_model_name#"},{"id":"db5fdafa-4cbf-44ba-9cca-8a98f1f771f4","from":"Input","name":"temperature","type":"Number","value":0.0},{"id":"88f74d78-4711-4f81-a2e7-74d0034c5e88","from":"Expand","name":"prompt","type":"Object","value":[{"id":"35a710cf-1b79-4523-b16f-b50878d677fe","from":"Input","name":"template","type":"String","value":"请按照以下步骤生成您的回复：\n1. 递归地将问题分解为更小的问题。\n2. 对于每个原子问题，从上下文和对话历史记录中选择最相关的信息。\n3. 使用所选信息生成回复草稿。\n4. 删除回复草稿中的重复内容。\n5. 在调整后生成最终答案，以提高准确性和相关性。\n6. 请注意，只需要回复最终答案。\n-------------------------------------\n上下文信息：\n\n{{knowledge}}\n\n问题：{{query}}"},{"id":"38fb27a1-71f4-4fcc-87d5-9d8a880bc04d","from":"Expand","name":"variables","type":"Object","value":[{"id":"aeba7823-8d14-4750-9723-55265ae71c4e","from":"Reference","name":"knowledge","type":"String","value":["output","retrievalOutput"],"referenceId":"5c9c6535-c127-445a-862a-966cf1083929","referenceKey":"retrievalOutput","referenceNode":"jade0pg2ag"},{"id":"eee66922-4304-4209-89fc-b13ffa101630","from":"Reference","name":"query","type":"String","value":["Question"],"referenceId":"input_ae2ffd6e-2b9e-4e73-9d7f-0e661ec3dbdb","referenceKey":"Question","referenceNode":"jade6qm5eg"}]}]},{"id":"a6865419-867c-4bfb-855c-f5c1876c965a","from":"Expand","name":"tools","type":"Array","value":[]},{"id":"308e2023-a8e9-486e-9784-8680addbb786","from":"Expand","name":"workflows","type":"Array","value":[{"id":"ae0bd892-91fc-45ef-83ca-819294384386","from":"input","type":"String","value":"d613c69e-ad85-4edb-a126-8ccd6341cd64"}]},{"id":"68f92923-d5da-42ce-8478-d7ac7d90664e","from":"Input","name":"systemPrompt","type":"String","value":""}],"outputParams":[{"id":"95d84d67-3198-415e-a63c-bc9a2da8d821","from":"Expand","name":"output","type":"Object","value":[{"id":"272c927a-9e25-48b6-a921-6a8ab20267a4","from":"Input","name":"llmOutput","type":"String","value":"","description":""}]}]}}},"triggerMode":"auto","joberFilter":{"type":"MINIMUM_SIZE_FILTER","threshold":1}},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"completedTask":0,"componentName":"llmComponent","focusBackColor":"white","enableAnimation":false,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBorderColor":"rgba(28,31,35,.08)"},{"x":1169.4642857142849,"y":306.4285714285713,"id":"jadesoux5i","pad":6,"bold":false,"text":"结束","type":"endNodeEnd","dirty":false,"index":106,"width":360,"height":214,"italic":false,"shadow":"0 2px 4px 0 rgba(0,0,0,.1)","sourcePlatform":"official","flowMeta":{"callback":{"name":"通知回调","type":"general_callback","fitables":["modelengine.fit.jober.aipp.fitable.AippFlowEndCallback"],"converter":{"type":"mapping_converter","entity":{"inputParams":[{"id":"ffad80c2-3f60-4d57-93b2-c2362a5dab9c","from":"Reference","name":"finalOutput","type":"String","value":["output","llmOutput"],"referenceId":"272c927a-9e25-48b6-a921-6a8ab20267a4","referenceKey":"llmOutput","referenceNode":"jadewdnjbq"}],"outputParams":[{}]}}},"triggerMode":"auto"},"hideText":true,"backColor":"white","container":"elsa-page:tvp1s6","dashWidth":0,"deletable":true,"namespace":"flowable","autoHeight":true,"rotateAble":false,"borderColor":"rgba(28,31,35,.08)","borderWidth":1,"focusShadow":"0 0 1px rgba(0,0,0,.3),0 4px 14px rgba(0,0,0,.1)","runningTask":0,"triggerMode":"auto","warningTask":0,"cornerRadius":8,"completedTask":0,"componentName":"endComponent","focusBackColor":"white","enableAnimation":false,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBorderColor":"rgba(28,31,35,.08)"}],"vAlign":"top","itemPad":[0,0,0,0],"division":-1,"dockMode":"none","fontFace":"arial","fontSize":18,"hideText":true,"moveable":true,"shapesAs":{},"backColor":"#fbfbfc","container":"elsa-page:tvp1s6","dockAlign":"top","fontColor":"#ECD0A7","fontStyle":"normal","itemSpace":5,"namespace":"jadeFlow","fontWeight":"bold","itemScroll":{"x":0,"y":0},"borderColor":"white","focusBackColor":"#fbfbfc"}],"title":"b2ecde0b919841f5867d2e89bb46095c","source":"elsa","tenant":"default","setting":{"pad":10,"tag":{},"code":"","pDock":"none","hAlign":"center","margin":25,"shadow":"","shared":false,"vAlign":"top","itemPad":[5,5,5,5],"visible":true,"autoText":false,"dockMode":"none","dragable":true,"editable":true,"fontFace":"arial","fontSize":12,"infoType":{"name":"none","next":"INFORMATION"},"moveable":true,"priority":0,"allowLink":true,"autoWidth":false,"backAlpha":0.15,"backColor":"whitesmoke","dashWidth":0,"deletable":true,"fontColor":"steelblue","fontStyle":"normal","headColor":"steelblue","lineWidth":2,"underline":false,"autoHeight":false,"emphasized":false,"fontWeight":"lighter","itemScroll":{"x":0,"y":0},"lineHeight":1.5,"resizeable":true,"rotateAble":true,"scrollLock":{"x":false,"y":false},"selectable":true,"shadowData":"2px 2px 4px","borderColor":"#047bfc","borderWidth":1,"bulletSpeed":1,"focusMargin":0,"focusShadow":"","globalAlpha":1,"outstanding":false,"bulletedList":false,"cornerRadius":4,"enableSocial":true,"mouseInColor":"orange","numberedList":false,"rotateDegree":0,"captionhAlign":"center","strikethrough":false,"focusBackColor":"whitesmoke","focusFontColor":"darkorange","progressStatus":{"name":"NONE","next":"UNKNOWN","color":"gray"},"showedProgress":false,"captionfontFace":"arial black","captionfontSize":14,"enableAnimation":false,"progressPercent":0.65,"captionfontColor":"whitesmoke","captionfontStyle":"normal","focusBorderColor":"#047bfc","focusBorderWidth":1,"outlineWidth":10,"outlineColor":"rgba(74,147,255,0.12)","mouseInBackColor":"whitesmoke","mouseInFontColor":"orange","captionfontWeight":"lighter","captionlineHeight":1,"mouseInBorderColor":"#047bfc"},"flowMeta":{"enableOutputScope":true,"exceptionFitables":["modelengine.fit.jober.aipp.fitable.AippFlowExceptionHandler","modelengine.fit.jober.fitable.FlowInfoException"],"callback":{"fitables":["modelengine.fit.jober.fitable.FlowInfoCallback"],"name":"通知回调","type":"general_callback"}},"enableText":false}' where id = 'b2ecde0b919841f5867d2e89bb46095c';